name: React Hello World - Auto Grading

on: [push]

jobs:
  autograde:
    runs-on: ubuntu-latest

    steps:
    # ----------------------------
    # CHECKOUT
    # ----------------------------
    - name: Checkout repository
      uses: actions/checkout@v3

    # ----------------------------
    # HARD FAIL RULES (0 MARKS)
    # ----------------------------
    - name: ‚ùå Fail if node_modules committed
      run: |
        if find . -type d -name "node_modules" | grep -q .; then
          echo "‚ùå node_modules detected. Auto-fail (0 marks)."
          exit 1
        fi

    - name: ‚ùå Fail if React not imported
      run: |
        if ! grep -q "from 'react'" practical-2-hello-world/src/App.js; then
          echo "‚ùå React not imported in App.js. Auto-fail."
          exit 1
        fi

    - name: ‚ùå Fail if no JSX (HTML-only)
      run: |
        if ! grep -q "<[A-Za-z]" practical-2-hello-world/src/App.js; then
          echo "‚ùå No JSX detected. Must use React components."
          exit 1
        fi

    - name: ‚ùå Fail if Hello World in HTML file
      run: |
        if grep -i "hello world" practical-2-hello-world/public/index.html; then
          echo "‚ùå Hello World found in HTML file. Must be in React component."
          exit 1
        fi

    # ----------------------------
    # INITIALIZE SCORE
    # ----------------------------
    - name: Initialize score
      run: echo "SCORE=0" >> $GITHUB_ENV

    # ============================
    # GRADING CHECKS
    # ============================

    - name: ‚úÖ Check project structure (2 marks)
      run: |
        if [ -f practical-2-hello-world/package.json ] && \
           [ -f practical-2-hello-world/src/App.js ] && \
           [ -f practical-2-hello-world/src/index.js ]; then
          echo "‚úÖ Project structure correct"
          echo "SCORE=$((SCORE+2))" >> $GITHUB_ENV
        else
          echo "‚ùå Missing required files"
        fi

    - name: ‚úÖ Check npm install works (2 marks)
      run: |
        cd practical-2-hello-world
        if npm install --silent; then
          echo "‚úÖ npm install successful"
          echo "SCORE=$((SCORE+2))" >> $GITHUB_ENV
        else
          echo "‚ùå npm install failed"
        fi
        cd ..

    - name: ‚úÖ Check Hello World rendered (3 marks)
      run: |
        if grep -iq "hello world" practical-2-hello-world/src/App.js; then
          echo "‚úÖ Hello World rendered in App.js"
          echo "SCORE=$((SCORE+3))" >> $GITHUB_ENV
        else
          echo "‚ùå Hello World not found in App.js"
        fi

    # ----------------------------
    # FINAL SCORE
    # ----------------------------
    - name: Display Final Score
      run: |
        echo "========================================"
        echo "        HELLO WORLD PRACTICAL"
        echo "========================================"
        echo ""
        echo "  Grading Results:"
        echo "  - Project structure: 2/2"
        echo "  - npm install works: 2/2"
        echo "  - Hello World rendered: 3/3"
        echo ""
        echo "  ------------------------------------"
        echo "  FINAL SCORE: $SCORE / 7"
        echo "========================================"
        
        if [ $SCORE -eq 7 ]; then
          echo "üéâ PERFECT SCORE! Well done!"
        elif [ $SCORE -ge 5 ]; then
          echo "‚úÖ Good job!"
        elif [ $SCORE -ge 3 ]; then
          echo "‚ö†Ô∏è  Passing, but needs improvement"
        else
          echo "‚ùå Needs work - review requirements"
        fi

    - name: Create score file
      run: |
        echo "Hello World Practical Score: $SCORE/7" > score.txt
        echo "Graded on: $(date)" >> score.txt
        echo "" >> score.txt
        echo "Breakdown:" >> score.txt
        echo "- Project structure: 2 marks" >> score.txt
        echo "- npm install works: 2 marks" >> score.txt
        echo "- Hello World rendered: 3 marks" >> score.txt

    - name: Upload score artifact
      uses: actions/upload-artifact@v3
      with:
        name: grading-results
        path: score.txt
